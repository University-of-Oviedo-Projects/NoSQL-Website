<!DOCTYPE html>

<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="author" content="Equipo XXX">
        <meta name="keywords" content="World War II, WWII">
        <meta name="description" content="Website about World War II">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>World War II Website - Configuración</title>
        <link rel="icon" href="html/multimedia/favicon.ico">

        <!-- Preload & load local CSS -->
        <link rel="preload" href="../css/global.css" as="style">
        <link rel="stylesheet" href="../css/global.css">
        <link rel="preload" href="../css/index.css" as="style">
        <link rel="stylesheet" href="../css/index.css">

        <!-- Bootstrap CSS -->
        <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">

        <!-- JQuery, Popper.js, Bootstrap JS -->
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
        <script defer src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <script defer src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    </head>
    <body>
        <header class="bg-dark text-white p-4">
            <div class="container">
                <h1 class="display-4">World War II - Configuración</h1>
            </div>
        </header>

        <div class="container mt-4">
            <div class="text-center mb-4">
                <h2>Configuración de la base de datos</h2>
                <p>Para acceder a la información de la base de datos, necesitamos que configures las credenciales correspondientes. Este formulario solo será visible si aún no has configurado las credenciales.</p>
            </div>

            <div class="row">
                <div class="col-md-6 offset-md-3">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">Configuración de Neo4j</h5>
                            <form id="db-config-form">
                                <div class="form-group">
                                    <label for="neo4j-url">URL de la instancia Neo4j</label>
                                    <input type="text" class="form-control" id="neo4j-url" placeholder="Ejemplo: neo4j+s://<url>" required>
                                </div>
                                <div class="form-group">
                                    <label for="neo4j-user">Usuario</label>
                                    <input type="text" class="form-control" id="neo4j-user" placeholder="Usuario de Neo4j" required>
                                </div>
                                <div class="form-group">
                                    <label for="neo4j-password">Contraseña</label>
                                    <input type="password" class="form-control" id="neo4j-password" placeholder="Contraseña de Neo4j" required>
                                </div>
                                <button type="submit" class="btn btn-primary">Guardar Configuración</button>
                            </form>
                            <div id="message" class="mt-3" style="display:none;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            async function saveConfig(event) {
                event.preventDefault();
                console.log('Guardando configuración...');
                
                const url = document.getElementById('neo4j-url').value;
                const user = document.getElementById('neo4j-user').value;
                const password = document.getElementById('neo4j-password').value;

                const config = {
                    url: url,
                    user: user,
                    password: password
                };

                try {
                    const response = await fetch('http://localhost:3000/config', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(config)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        document.getElementById('message').textContent = result.message;
                        document.getElementById('message').style.display = "block";
                        document.getElementById('db-config-form').style.display = "none";
                        window.location.href = 'html/home.html';
                    } else {
                        document.getElementById('message').textContent = "Hubo un error al guardar la configuración.";
                        document.getElementById('message').style.display = "block";
                    }
                } catch (error) {
                    console.error('Error al guardar la configuración:', error);
                    document.getElementById('message').textContent = "Error de conexión con el servidor.";
                    document.getElementById('message').style.display = "block";
                }
            }

            document.getElementById('db-config-form').addEventListener('submit', saveConfig);
        </script>
    </body>
</html>
